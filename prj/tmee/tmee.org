* tmp
ysd_tsll: tycs 0813

* task
** TODO 垫退税按天计算利息
收付明细中增加两列输出：dtsIO bclx_dts， bclx只计算垫款利息，垫退税利息在bclx_dts中。
利息计算存储过程增加输出参数：@v_dtslx_sj: 垫款利息与实际垫退税利息分别输出
*** TODO Q
- State "TODO"       from ""           [2013-08-02 五 18:07]
？收付明细中：可能导致余额（含垫退税部分）与利息/利率不一致
？收付明细中是否要增加字段来显示增加的垫退税信息列
？垫退税利率换成月利率后，预算/应收付中应该如何显示垫退税利息
？0.03替换成什么
*** DONE 结算单中需要区分利息和垫退税利息
CLOSED: [2013-08-02 五 18:05]
- State "DONE"       from "TODO"       [2013-08-02 五 18:05]
- State "TODO"       from ""           [2013-07-31 三 16:07]

*** DONE 收付明细中区分利息和退税利息
CLOSED: [2013-08-02 五 18:06]
- State "DONE"       from "TODO"       [2013-08-02 五 18:06]
- State "TODO"       from ""           [2013-07-31 三 16:07]

*** DONE 只有已做退税单后，才能使用垫退税，之前不能用垫退税计算利息
CLOSED: [2013-08-02 五 18:06]
- State "DONE"       from "TODO"       [2013-08-02 五 18:06]
- State "TODO"       from ""           [2013-07-31 三 16:08]

*** DONE 根据申报退税确定本票的垫退税计算：是按0.03还是按天
CLOSED: [2013-08-02 五 17:41]
- State "DONE"       from "TODO"       [2013-08-02 五 17:41]
- State "TODO"       from ""           [2013-07-31 三 16:34]
*** DONE 付款申请的时候已经可以用垫退税了 但实际收付时却没有按垫退税处理 而是按垫款处理的 RE： 已经按垫退税处理了，从存储过程返回的垫退税额中可以看出
CLOSED: [2013-07-31 三 16:05] 
- State "DONE"       from "TODO"       [2013-07-31 三 16:05]
- State "TODO"       from ""           [2013-07-30 二 17:12]
- State "TODO"       from ""           [2013-07-30 二 17:12]
20122013-07-30 17:02:08	
    昨天你发给我的更新内容我在测试库测了 现在发现有一个新的问题 就是付款申请的时候已经可以用垫退税了 但实际收付时却没有按垫退税处理 而是按垫款处理的 
** DONE 测试服务器无法运行收付明细 RE:存储过程版本问题
CLOSED: [2013-07-30 二 17:09]
- State "DONE"       from "TODO"       [2013-07-30 二 17:09]
2012  15:28:06
tmee13j0001 我做的
你晚上有空的话就帮我看看
商敬民  15:30:07
好的
** DONE 有两票公共费用不能审核
2012  10:00:18
对 有两件事 
今天发现erp——基础资料——供应商管理在添加或修改供应商的细表内容时，从认证情况、重要关系企业等以后的项目都不能正常保存，有空的时候帮忙看一下  （RE：36上未发现不能保存的情况）
商敬民  10:00:31
好
2012  10:03:15
还有就是有两票公共费用有点问题 ggfy20130416 ggfy20130408 不能继续审核了  （RE：需要填写下面的金额才可审核保存）
** DONE 垫退税利息
old是当前系统的处理方式;new是如果修改，可能的处理方式。
有些可能理解的并不正确，周师傅和主任发现错误再标出来
*** old: 预算中显示，收付明细可退税即算收入；垫退税不算垫款；若有垫款或垫退税，都按垫款算利息
     结算中：未算垫退税利息
     清算：同结算
     收付明细：只要无结余金额，就按垫款算
     付款申请： 同结算

*** new: 可退税不算收入，实际退税后才进收入；付款用垫款时计算利息，若付款类型为垫退税，则按垫退税计息，否则按垫款计息
**** 预算： 根据合同日期确定垫退税利率，据此计算垫款；若合同跨2013.6.1,依然根据合同日期所属时间确定利率
**** 结算： 是否算垫退税利息？
如果算：只对付款申请设为垫退税的计算垫退税利息，计算时不管垫退税期限，直接用垫退税额×点退税利率。已/实收付中，若已付款，则按实际付款日期确定利率，若未付款，则按申请日期确定利率
**** 清算：同结算
**** 收付明细：无结余金额，若付款申请为垫退税，则按实际付款日期的垫退税利率计算，否则按垫款算
**** 付款申请：同结算

*** step1: 利息计算： 垫款时在预算中指定使用垫退税时优先使用垫退税，无垫退税时才用垫款
** DONE 更改科目代码
*** SN info
**** new data: snsoftn7_tjjdxin
**** new king field:
unitking	fcodeking	financeking	bankking

数量单位	币种码	金融机构	银行账户

**** king code in SN ?unitking = dictinfo.langname1?
数量单位：unitking 根据商品表( gcode )中的计量单位字段（ qtyunit），对应（dictinfo）表，字段（dictid） = 16的，字段（code） 等于（gcode） 表中（qtyunit）的, 字段为remark
币种：fcodeking 取自币种表 （fcode） 中的（langname1）
金融机构：financeking 取自科目表（acode）字段（financeking）
银行账户：bankking 取自科目表（acode）字段（bankking ）



徐梁－ｎｓ  22:45:41
1002 和 1003 区别
科目表(acode)字段(property) 值为 65 的是人民币
                                                 195 的是外币 
徐梁－ｎｓ  22:47:49
数量单位：unitking 根据商品表( gcode )中的计量单位字段（ qtyunit），对应（dictinfo）表，字段（dictid） = 16的，字段（code） 等于（gcode） 表中（qtyunit）的

币种：fcodeking 取自币种表 （fcode） 中的（langname1）
徐梁－ｎｓ  22:50:54
金融机构：financeking 取自科目表（acode）字段（financeking）
银行账户：bankking 取自科目表（acode）字段（bankking ）
但只适用与1002科目

徐梁－ｎｓ  22:55:19
1015科目，1122科目，2001科目的
金融机构：financeking和银行账户：bankking ，根据凭证录入时所选择的客户，从客户表（ccode）中的字段（remark）金融机构，（addr）银行账户中选择
其余科目不涉及金融机构和银行账户


徐梁－ｎｓ 2013-1-20 14:01:27
对了
我给你发的文件里，部门分2个sheet页
他的第一个有部分是错误的，正确的在第二个里
徐梁－ｎｓ 2013-1-20 14:02:34
我都更新完数据他们才发现原来提供的是错误的

*** work
**** 更新相关视图 erp_sn --> snsoftn7_tjjdxni
**** 更新基础信息数据： 
**** 1003的处理
**** king 4字段
1132 1009
left join 
**** ？VAcc_Bank: left(7) ---> left(6)
**** ？部门码： 101 公司本部
**** ？计量单位:：对应dictinfo表的langname1字段
**** xl replace
徐梁－ｎｓ 2013-1-20 23:03:05
还在么
第一个问题明天说，数据库在本机里，
部门码101对应060401
徐梁－ｎｓ 2013-1-20 23:04:05
我给你发的更新码.xls文件中的部门1sheet里有
徐梁－ｎｓ 2013-1-20 23:06:55
第三个问题也明天说，台式上没有数据库
更新码文件中
徐梁－ｎｓ 2013-1-20 23:07:56
凡是列明为 *king的就是金蝶新码，列名为*snsoft的就是南北的老码

1003  取消，合并到1002向下
1131  对应  11220201
1151  对应  11230201
2121  对应  22020201
2125  对应  22020202
5501005  取消
5501008  取消
5501013  对应  660118
5501999  取消
5401001001  为非末级科目，不需要对应，其明细科目对应见下表 5401001001001 --- *099
5401001002002  取消 
5401001002011  取消

*** 相关准备：
**** 
**** 业务财务编码对照需要修改：客户/供应商/商品库/人员/币种/银行/国别地区
**** 
**** 确定财务数据库名称： 将erp_sn替换为该名称
**** 更改科目
***** sql
declare @km101 varchar(16), @km1001 varchar(16), @km1002 varchar(16), @km1003 varchar(16), @km1131 varchar(16), @km1132 varchar(16), @km1151 varchar(16), @km1152 varchar(16), @km2121 varchar(16), @km2125 varchar(16)
declare @km1243001 varchar(16), @km1243002 varchar(16), @km5501003 varchar(16), @km5501005 varchar(16), @km5501006 varchar(16), @km5501008 varchar(16), @km5501009 varchar(16)
declare @km5501013 varchar(16), @km5501016 varchar(16), @km5501017 varchar(16), @km5501023 varchar(16), @km5501024 varchar(16), @km5501025 varchar(16), @km5501026 varchar(16)
declare @km5501028 varchar(16), @km5501033 varchar(16), @km5501035 varchar(16), @km5501999 varchar(16), @km5503004 varchar(16), @km5101001001 varchar(16)
declare @km5401001001 varchar(16), @km5503001001 varchar(16), @km5503001002 varchar(16), @km5503003001 varchar(16), @km5503003002 varchar(16)
declare @km2171001001002 varchar(16), @km2171001001005 varchar(16), @km2171001005005 varchar(16), @km2171001007002 varchar(16)
declare @km5101001002001 varchar(16), @km5101001002002 varchar(16), @km5101001002003 varchar(16), @km5101001002004 varchar(16)
declare @km5401001002001 varchar(16), @km5401001002002 varchar(16), @km5401001002005 varchar(16), @km5401001002006 varchar(16)
declare @km5401001002007 varchar(16), @km5401001002010 varchar(16), @km5401001002011 varchar(16)

select @km101='101', @km1001='1001', @km1002='1002', @km1003='1003', @km1131='1131', @km1132='1132', @km1151='1151', @km1152='1152', @km2121='2121', @km2125='2125'
select @km1243001='1243001', @km1243002='1243002', @km5501003='5501003', @km5501005='5501005', @km5501006='5501006', @km5501008='5501008', @km5501009='5501009'
select @km5501013='5501013', @km5501016='5501016', @km5501017='5501017', @km5501023='5501023', @km5501024='5501024', @km5501025='5501025', @km5501026='5501026'
select @km5501028='5501028', @km5501033='5501033', @km5501035='5501035', @km5501999='5501999', @km5503004='5503004', @km5101001001='5101001001'
select @km5401001001='5401001001', @km5503001001='5503001001', @km5503001002='5503001002', @km5503003001='5503003001', @km5503003002='5503003002'
select @km2171001001002='2171001001002', @km2171001001005='2171001001005', @km2171001005005='2171001005005', @km2171001007002='2171001007002'
select @km5101001002001='5101001002001', @km5101001002002='5101001002002', @km5101001002003='5101001002003', @km5101001002004='5101001002004'
select @km5401001002001='5401001002001', @km5401001002002='5401001002002', @km5401001002005='5401001002005', @km5401001002006='5401001002006'
select @km5401001002007='5401001002007', @km5401001002010='5401001002010', @km5401001002011='5401001002011'

***** 使用的科目码
5503003001
101
1151
1152
1131
2125
5401001002005
5101001002003
5503003001
5503003002
5101001002004
5503001001
5503001002
5401001002007
5401001002002
5401001002011
5401001002011
5401001002007
5401001002010
5501013
5501023
5501024
5501024
5501033
5501025
1131
1132
5501017
5501026
5501028
5401001002006
5501016
5501005
5501999
5503004
1243002
2171001001002
2171001001005
5401001002001
2171001007002
5101001002001
2171001005005
5503004
1002
1003
1243002
2171001001002
2171001001005
1131
2171001007002
1132
2171001005005
5503004

2121
5501006
5101001002002
5501008
5501003
5501009
5501035
1001 现金
5401001001
1243001
5101001001
2171001005005
5401001001
5101001001
2171001005005

***** 排重后的科目码
101
1001
1002
1003
1131
1132
1151
1152
2121
2125
1243001
1243002
5501003
5501005
5501006
5501008
5501009
5501013
5501016
5501017
5501023
5501024
5501025
5501026
5501028
5501033
5501035
5501999
5503004
5101001001
5401001001
5503001001
5503001002
5503003001
5503003002
2171001001002
2171001001005
2171001005005
2171001007002
5101001002001
5101001002002
5101001002003
5101001002004
5401001002001
5401001002002
5401001002005
5401001002006
5401001002007
5401001002010
5401001002011

** DONE 在吗 有空帮我看看TMEE12F0104退税额为何未0 : 入库单明细与采购合同明细不对应
   20122012-08-30
   在吗 有空帮我看看TMEE12F0104退税额为何未0
** DONE 12h0102，0096这两票 字段清算审核流程显示为自检——财务 但实际审核流程却是自检-业务经理-事业部长-业务副总-财务 : 重新申请清算后，流程提示就计算正确了
   20122012-08-21 14:29:18
   在吗 有时间帮我看看12h0102，0096这两票 字段清算审核流程显示为自检——财务 但实际审核流程却是自检-业务经理-事业部长-业务副总-财务
** DONE 供应商 增加 延期申请， 以调整有效期，申请后需 合规 审核才能使用，未审核期间视为未生效 : 修改和编译预算单表单，需要使用windows，防止加密后无法打开问题
** DONE 如：延期申请，点完后可以改日期，但提交后自动到合规状态，也就是说随时可改不可控 : 延期申请保存后需要“合规”审核后才能有效；修改提示信息“有效期-->协议有效期”
客户的有效期限（不是协议有效期）没有体现

商敬民  15:59:25
哦，这个比较严重
周  15:59:42
客户有效期、协议有效期能否有延期功能？

客户有效期没有什么意义，不同于供应商有效期
** DONE  付款申请： 增加 审核流程 提示
   CLOSED: [2012-05-20 日 14:32]
** DONE 出口合同的合同号 修改时 能不能修改
   CLOSED: [2012-05-20 日 15:02]
20122012-05-11 17:18:48在吗 20122012-05-11 17:19:18咱们的出口合同的合同号能更改吗 20122012-05-11 17:19:33改完怎么保存不上啊 商敬民2012-05-11 17:20:46忘记了，好像是说要顺序产生的 【提示：此用户正在使用Q+ Web：http://webqq.qq.com/】商敬民2012-05-11 17:21:08是新增合同的时候么？20122012-05-11 17:23:01不是 是变更以后修改 20122012-05-11 17:23:1112I0031
** DONE 业务经历修改
   CLOSED: [2012-05-20 日 15:03]

 周 2012-3-8 10:39:08
出现个问题：八部经理改为焦捷，别的没事，这个改完焦捷只能看自己的
adm  结构  都改了
周 2012-3-8 10:39:28
11h0521
周 2012-3-8 10:39:51
还有：能否将采购审核也加上审核流程提示
周 2012-3-8 10:40:08
jiaoj1   666666

** DONE 修改公告费用查询，申请明细完全没有票号也可以支持
   CLOSED: [2012-02-09 四 11:22]
** DONE 公共费用添加后查询不出: 是因为所有的申请明细都没有填票号的原因
   CLOSED: [2012-01-31 二 09:47]
   ggfy20120130
   ggfy_id = 214
** DONE 科目调整
   CLOSED: [2012-01-16 一 10:19]
5401    主营业务成本    5501    营业费用
5401001002005       保险费      5501006 保险费
5401001002006       修理费      5501035 修理费
5401001002007       运杂费      5501003 运输费
5401001002008       佣金        5501014 佣金支出
5401001002009       样品费      5501015 样品费
5401001002010       检验费      5501009 检验费
5401001002011       保管费      5501008 保管费
将ERP中出口票号下原转生为营业费用的付款凭证转生为对应的主营业务成本科目

将ERP中原转生为5401001002  自营出口  科目的转生凭证转生为5401001002001    销售成本    科目

** DONE 客户： 延期申请可用不必受协议有效期小于当前时间的限制
   CLOSED: [2012-01-14 六 14:09]
** DONE erp客户增加内容：延期申请、协议号
   CLOSED: [2012-01-08 日 23:06]
1.增加【延期申请】按钮
     要求：【客户编码】【中文全称】【英文全称】【协议号】不得修改，其余可以修改
    （如果以上字段存在修改，则新增协议）
2。如果【协议号】存在，则【协议有效期】为必填项，包含在新增、修改等处

** DONE 申请清算前检查是否有未完成付款的公共费用
   CLOSED: [2012-01-04 三 20:57]
奇西公主  15:38:48
ERP中要增加清算条件，若公共费用未完成，则提示不能申请清算。
奇西公主  15:40:34
如：公共费用在已审核未付款状态时，目前允许清算，应改为不能清算。
** DONE 清算列表：进入时不自动加载数据
   CLOSED: [2012-01-04 三 20:57]

** DONE 清算问题20111025
   CLOSED: [2011-12-16 五 16:53]
周  16:18:18
有几个关于清算的问题有时间帮忙改一下：
1.常务副总改为业务副总，只能不变
2.查询：按日期查询 开始日期无下拉菜单，无法设定
3.清算申请条件之一：原条件退税为  已退税 ，现改为已上报即可，并将  已上报  状态做原已退税处理，即视作退税完成
** DONE 客户、供应商编码规范
   CLOSED: [2011-02-16 三 14:26]
*** 需求
客户管理编码规则：
TM+部门码（XX）+人员码（XXX）+K+本人流水号（XXXX）
供应商编码规则：
TM+部门码（XX）+人员码（XXX）+G+本人流水号（XXXX）
自动产生不得编辑
目前已有的全部按照现规则刷新
*** 开发
    部门/人员码不足位数时用0补全
本人流水号：根据库中当前业务员对应记录数+1；如果有删除操作，可能会导致编码冲突
原有数据的编码尚未更新

** DONE 出口合同中增加供货单位编码，以防止同名供应商选择错误
   CLOSED: [2011-02-28 一 09:07]
*** 需求
    出口采购合同： 选择对应进口合同是：货源单位没有编码不好区分
    可能有同名的多条供应商，进口合同维护时不宜区分，可能选择错误
*** 开发
    在进口合同维护中：增加供货单位编码的显示：供货单位changed时刷新
    在出口采购合同的 出口合同选择界面：增加供货单位编码的显示，以区分供应商

** DONE 清算：调账、二级账不参与付款或审核判断
   CLOSED: [2011-02-27 日 00:17]
   周 11:34:30
清算：
1.如果付款是调账，则不参与判断是否有未付款或未审核判断（TMEE10F0549申请清算）
RE: 若为调账、二级帐，则不参与付款或审核判断
2.清算审核流程需要提示，（即申请清算后业务员知道需要何处审核）
RE: 出口清算申请时计算，若预算利润率>实际利润率，则需业务经理-分管副总-常务副总审核后财务审；否则自检后直接到财务审
    进口清算：各级均审，且清算时的计算需要确定是否正常
3.董雁有些问题，你和她直接联系吧，我说不清楚，关于南北改动后ERP报表问题

周 11:52:52
收款齐否：如果已做退税，则不允许修改收汇齐
RE: 这个不好判断，因不是单条操作，而是领单时同时对多个发票号进行操作的。
** DONE 周  15:51:29 进口代理协议--是否提供增值税发票改为必填项
   CLOSED: [2011-02-28 一 09:07]
   RE: 新添加或修改的代理协议会控制必填，如果有已自检而未走完审核流程的，可能会导致无法审核保存

** DONE 周 10:57:26 TMEE10C0213，该票预算利润率=实际利润率，为何还要都审？进位的问题么？
   CLOSED: [2011-03-03 四 09:24]
2.清算审核流程需要提示，（即申请清算后业务员知道需要何处审核）
RE: 出口清算申请时计算，若预算利润率>实际利润率，则需业务经理-分管副总-常务副总审核后财务审；否则自检后直接到财务审
1.？？TMEE10C0213，该票预算利润率=实际利润率，为何还要都审？进位的问题么？

** DONE 周 10:57:26 2.将各界面总会改为总监，呵呵
   CLOSED: [2011-03-07 一 09:12]

** DONE 周 11:10:40 3.业务员收汇填写收汇齐条件：正负100美金，超过则需要财务改（现在为-100~~正无穷）
   CLOSED: [2011-03-31 四 15:20]
** DONE ERP结汇预警更改说明: ? 结汇日期带入是只指：结汇预警查询中
   CLOSED: [2011-03-31 四 15:20]
一、加字段
1.核销退税——核销管理——领单成功后，在点击核销按钮弹出的界面加上两个字段。
a.预计结汇日期（完成结汇的期限）：必填项，并作为业务财务管理——结汇预警界面中过期天数的数据来源，取消预算单中的结汇期限作为结汇预警中过期天数的数据来源。
b.预算结汇期限：数据结果由预算单中的结汇期限带入。
2.业务财务管理——结汇预警界面增加过期天数，方便操作人员查询预警信息。
二、结汇日期带入
若领取核销单以后并未核销(即核销处为空),则有条件将预算单中结汇日期带入：条件：1.已存在核销单且状态≥核销则带入。核销单退回或注销均视作核销处为空即不做结汇预警处理。
        2.若无核销单，则结汇期限为空，结汇预警处不处理即不报警。
        3.票号为2010年（含2010年）以后的做结汇预警处理，2009年以前（含2009年）不做处理。
** 发票打印  出运收货人  不能打印完全
   日期:2011-3-31
周 13:46:13
发票打印  出运收货人  不能打印完全
TMEE11C0066
只能打印到
** CANCELED 更新ysd中得客户，但客户表中的已是正确的了
     重新生成合同
   CLOSED: [2010-12-06 一 13:40]
   select dlxy_id,tdkh.kh_zwqc,tdkh.kh_zwdz,kh_dh,kh_lxr
     from tddlxy Left outer join tdkh on dlxy_bdlfid=kh_id
     where dlxy_id = 122
   update TDysd set kh_zwqc = '汤玉晶' where ysd_id = 13572

   select *
     from TDysd
       left join TDckht on ckht_id=ysd_htid
       left join TDdlxy on dlxy_id = ckht_dlxyid
     where ysd_id = 13572
